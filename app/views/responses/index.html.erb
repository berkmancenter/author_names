<div class="col-lg-12">
  <h1>New Responses</h1>
  <% unless @response_hash_new.nil? %>
  <div class="table-responsive">
    <% if current_user.is_publisher? || current_user.is_librarian? || current_user.try(:superadmin?) %>
      <%= link_to("Export All Responses", export_responses_path ) %> | <%= link_to "Retrieve as XML", isni_responses_path(:format => 'xml') %>
    <% end %>  
	<table id="responses-table" class="table table-striped table-hover tablesorter">
  	<thead>
  	  <tr>
  		<th>Name</th>
  		<th>Date</th>
		<% if current_user.is_publisher? %>
  		  <th>Questionnaire</th>
		<% elsif current_user.is_librarian? %>
		  <th>Publisher</th>
		<% end %>    
		<th>Title</th>
		<th>Actions</th>
  	  </tr>
  	</thead> 
  	<tbody>
  	  <% @response_hash_new.each_key do |questionnaire| %>
		<% @response_hash_new[questionnaire].each_key do |user| %>
		  <% resp_date, q_name, pub_name, resp = "", "", "" %>
  	      <tr>
  	  	  <td><%= User.find(user).full_name_email %></td>
		  <% @response_hash_new[questionnaire][user].each do |response| %>
		    <% resp_date = response.created_at.strftime("%m/%d/%Y") %>
			<% q_name = response.questionnaire.name %>
			<% pub_name = response.questionnaire.publisher.name %>
		    <% if response.form_item.field_name == "Title" %>
  		      <% resp = response.response_text %>
		    <% else %>	
  		      <% resp = "None" %>
		    <% end %>	
		  <% end %>	
		  <td><%= resp_date %></td>
  		  <% if current_user.is_publisher? %>
    		<td><%= q_name %></td>
  		  <% elsif current_user.is_librarian? %>
  		    <td><%= pub_name %></td>
  		  <% end %>
		  <td><%= resp %></td>
		  <td>
			  <%= link_to "View", author_response_responses_path(:questionnaire => questionnaire, :user => user) %> | <%= link_to "Export Single", export_single_responses_path(:questionnaire => questionnaire, :user => user) %>
		  	  <% unless @csv.nil? %>
			    <% if @user == user %>
			      | <%= link_to "Download CSV", "/uploads/export_single_#{user}.csv" %>
				<% end %>
			  <% end %>
			    <% unless current_user.try(:superadmin?) %>  
			       | <%= link_to "Mark as Exported", mark_exported_responses_path(:questionnaire => questionnaire, :user => user) %>
				<% end %>  
		  </td>
  	      </tr>
  	    <% end %>
	  <% end %>	
  	</tbody>	
  	</table>
  	<%= render :partial => '/shared/tablesorter_pager', :locals => {:pager_id => "responses-table" } %>
  </div>
  <% else %>
    <br />
    No Responses
  <% end %>
</div>

<div class="col-lg-12">
  <h1>Past Responses</h1>
  <% if current_user.try(:superadmin?) %>
   <p>Both publisher and library have marked as exported</p>
  <% end %>
  <% unless @response_hash_past.nil? %>
  <div class="table-responsive">
    <% if current_user.is_publisher? || current_user.is_librarian? || current_user.try(:superadmin?) %>
      <%= link_to("Export All Responses", export_responses_path ) %> | <%= link_to "Retrieve as XML", isni_responses_path(:format => 'xml') %>
    <% end %>  
	<table id="responses-table" class="table table-striped table-hover tablesorter">
  	<thead>
  	  <tr>
  		<th>Name</th>
  		<th>Date</th>
		<% if current_user.is_publisher? %>
  		  <th>Questionnaire</th>
		<% elsif current_user.is_librarian? %>
		  <th>Publisher</th>
		<% end %>    
		<th>Title</th>
		<th>Actions</th>
  	  </tr>
  	</thead> 
  	<tbody>
  	  <% @response_hash_past.each_key do |questionnaire| %>
		<% @response_hash_past[questionnaire].each_key do |user| %>
		  <% resp_date, q_name, pub_name, resp = "", "", "" %>
  	      <tr>
  	  	  <td><%= User.find(user).full_name_email %></td>
		  <% @response_hash_past[questionnaire][user].each do |response| %>
		    <% resp_date = response.created_at.strftime("%m/%d/%Y") %>
			<% q_name = response.questionnaire.name %>
			<% pub_name = response.questionnaire.publisher.name %>
		    <% if response.form_item.field_name == "Title" %>
  		      <% resp = response.response_text %>
		    <% else %>	
  		      <% resp = "None" %>
		    <% end %>	
		  <% end %>	
		  <td><%= resp_date %></td>
  		  <% if current_user.is_publisher? %>
    		<td><%= q_name %></td>
  		  <% elsif current_user.is_librarian? %>
  		    <td><%= pub_name %></td>
  		  <% end %>
		  <td><%= resp %></td>
		  <td>
			  <%= link_to "View", author_response_responses_path(:questionnaire => questionnaire, :user => user) %> | <%= link_to "Export Single", export_single_responses_path(:questionnaire => questionnaire, :user => user) %>
		  	  <% unless @csv.nil? %>
			    <% if @user == user %>
			      | <%= link_to "Download CSV", "/uploads/export_single_#{user}.csv" %>
				<% end %>
			  <% end %>
		    <% if current_user.try(:superadmin?) %>
			   | <%= link_to "Delete", delete_group_responses_path(:questionnaire => questionnaire, :user => user), :confirm => "Are you sure? This action cannot be undone." %>
			<% end %>
		  </td>
  	      </tr>
  	    <% end %>
	  <% end %>	
  	</tbody>	
  	</table>
  	<%= render :partial => '/shared/tablesorter_pager', :locals => {:pager_id => "responses-table" } %>
  </div>
  <% else %>
    <br />
    No Responses
  <% end %>
</div>

