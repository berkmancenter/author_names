<div class="col-lg-12">
  <h1>Questionnaire Responses</h1>
  <div class="table-responsive">
    <% if current_user.try(:superadmin?) || current_user.is_pub_admin? %>
      <%= link_to("Add New Response", new_response_path ) %>
    <% end %>  
	<table id="responses-table" class="table table-striped table-hover tablesorter">
  	<thead>
  	  <tr>
  		<th>Name</th>
  		<th>Date</th>
  		<th>Questionnaire</th>
		<th>Title</th>
		<th></th>
  	  </tr>
  	</thead> 
  	<tbody>
  	  <% @response_hash.each_key do |questionnaire| %>
		<% @response_hash[questionnaire].each_key do |user| %>
		<% resp_date, q_name, resp = "", "", "" %>
  	    <tr>
  	  	  <td><%= User.find(user).full_name_email %></td>
		  <% @response_hash[questionnaire][user].each do |response| %>
		    <% resp_date = response.created_at.strftime("%m/%d/%Y") %>
			<% q_name = response.questionnaire.name %>
		    <% if response.form_item.field_name == "Title" %>
  		      <% resp = response.response_text %>
		    <% else %>	
  		      <% resp = "None" %>
		    <% end %>	
		  <% end %>	
		  <td><%= resp_date %></td>
		  <td><%= q_name %></td>
		  <td><%= resp %></td>
		  <td><%= link_to "View", author_response_responses_path(:questionnaire => questionnaire, :user => user) %></td>
  	    </tr>
  	    <% end %>
	  <% end %>	
  	</tbody>	
  	</table>
  	<%= render :partial => '/shared/tablesorter_pager', :locals => {:pager_id => "responses-table" } %>
	
  </div>
</div>

