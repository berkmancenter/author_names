<h3>Viewing: <%= @questionnaire.name %></h3>


<div id="welcome-left">
	<strong>Description:</strong> <%= @questionnaire.description %><br />
	<strong>Version:</strong> <%= @questionnaire.version %><br />
	<strong>Publisher:</strong> <%= @questionnaire.publisher %><br />
	<br />
	<strong>Form Items:</strong><br />
	<br />
	
	<%= semantic_form_for :gather_response, :html => { :method => :get } do |f| %>
	  <%= f.inputs do %>
	    <% @questionnaire.form_items.each do |item| %>
		  <% if item.field_type == "Label" %>
		    <p><%= raw item.display_text %></p>
		  <% else %>
		    <%= f.semantic_fields_for "#{item.field_name}", :html => { :method => :get } do |fi| %>
			  <%= fi.input :response_text, :as => item.formtastic_field_map, :label => item.display_text.html_safe, :collection => item.field_options.nil? ? '' : item.field_options.split(',') %>
			  <%= fi.input :form_item_id, :as => :hidden, :value => item.id %>
			  <%= fi.input :questionnaire_id, :as => :hidden, :value => @questionnaire.id %>
	  	      <% if current_user.try(:admin?) && !@user.nil? %>
	  	        <%= fi.input :user_id, :as => :hidden, :value => @user %>
	  	      <% else %>
			    <%= fi.input :user_id, :as => :hidden, :value => current_user.id %>
			  <% end %>
			<% end %>  
		  <% end %>
	    <% end %>
	  <% end %>
  	  <%= f.actions do %>
  	    <%= f.action :submit, :as => :button, :label => 'Submit Response ' %>
  	  <% end %>
	  
	<% end %>
</div>	

<div id="welcome-right" class="yellow-box">
<% if current_user.is_pub_admin? || current_user.is_pub_staff? %>

	<h4>Sort Order</h4>
	<%= semantic_form_for :sort_items, :html => { :method => :get } do |f| %>
      <% @questionnaire.form_items.each do |item| %>
	    <%= f.inputs do %>
	      Position <%= FormItemsQuestionnaires.first(:conditions => {:form_item_id => item.id, :questionnaire_id => @questionnaire.id }).form_item_position %> - <%= f.input item.field_name, :as => :select, :collection => (1..@questionnaire.form_items.count).to_a, :label => item.display_text.html_safe, :selected => FormItemsQuestionnaires.first(:conditions => {:form_item_id => item.id, :questionnaire_id => @questionnaire.id }).form_item_position.nil? ? '' : FormItemsQuestionnaires.first(:conditions => {:form_item_id => item.id, :questionnaire_id => @questionnaire.id }).form_item_position %>
		<% end %> 
      <% end %>
  	  <%= f.actions do %>
  	    <%= f.action :submit, :as => :button, :label => 'Submit Item Order ' %>
  	  <% end %> 
	<% end %>
<% end %>
</div>